<!-- SIDE (desktop) -->
<div
  *ngIf="variant === 'side'"
  class="transition-all duration-300 bg-white rounded-xl shadow-lg flex-col py-3 overflow-y-auto"
  [class.w-72]="open"
  [class.w-0]="!open"
  [class.opacity-100]="open"
  [class.opacity-0]="!open"
  [class.pointer-events-none]="!open"
  aria-label="Sidebar (desktop)"
>
  <nav class="flex-1 p-2">
    <ul class="space-y-2">
      <li *ngFor="let item of items">
        <!-- والد یا لینک ساده -->
        <button
          *ngIf="!item.children"
          class="flex items-center gap-2 w-full text-right px-2 py-2 rounded hover:bg-gray-100 transition"
          [class.bg-blue-50]="isActive(item)"
          [class.text-secondary]="isActive(item)"
          [routerLink]="item.routerLink"
        >
          <ng-icon *ngIf="item.icon" [name]="item.icon" class="!w-5 !h-5" />
          <span class="truncate">{{ item.label }}</span>
        </button>

        <div *ngIf="item.children">
          <button
            (click)="toggleSubmenu(item)"
            class="flex items-center gap-2 w-full text-right px-2 py-2 rounded hover:bg-gray-100 transition"
            [class.bg-blue-50]="isActive(item)"
            [class.text-secondary]="isActive(item)"
            [attr.aria-expanded]="isSubmenuOpen(item) ? 'true' : 'false'"
          >
            <ng-icon *ngIf="item.icon" [name]="item.icon" class="!w-5 !h-5" />
            <span class="truncate">{{ item.label }}</span>
            <ng-icon
              name="matExpandMoreOutline"
              class="ms-auto transition-transform duration-200 !w-5 !h-5"
              [class.rotate-180]="isSubmenuOpen(item)"
            />
          </button>

          <ul
            class="mr-6 mt-1 space-y-1 border-r border-gray-200 pr-2"
            [style.display]="isSubmenuOpen(item) ? 'block' : 'none'"
          >
            <li *ngFor="let child of item.children">
              <a
                [routerLink]="child.routerLink"
                class="flex items-center gap-2 px-2 py-1.5 rounded hover:bg-gray-100"
                [class.bg-blue-50]="isActive(child)"
                [class.text-secondary]="isActive(child)"
              >
                <span class="truncate">{{ child.label }}</span>
              </a>
            </li>
          </ul>
        </div>
      </li>
    </ul>
  </nav>
</div>

<!-- DRAWER (mobile) -->
<div
  *ngIf="variant === 'drawer'"
  class="fixed inset-0 z-50"
  [class.pointer-events-none]="!open"
  aria-label="Sidebar drawer (mobile)"
>
  <!-- Backdrop -->
  <div
    class="absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity duration-300"
    [class.opacity-100]="open"
    [class.opacity-0]="!open"
    (click)="close()"
  ></div>

  <!-- Drawer -->
  <div
    class="absolute right-0 top-0 bg-white w-64 h-full shadow-lg p-3 flex flex-col transform transition-transform duration-300 delay-100"
    [class.translate-x-0]="open"
    [class.translate-x-full]="!open"
  >
    <nav class="flex-1 p-2">
      <ul class="space-y-2">
        <li *ngFor="let item of items">
          <!-- آیتم ساده -->
          <a
            *ngIf="!item.children"
            [routerLink]="item.routerLink"
            class="flex items-center gap-2 px-2 py-2 rounded hover:bg-gray-100"
            [class.bg-blue-50]="isActive(item)"
            [class.text-blue-600]="isActive(item)"
            (click)="onItemClickCloseIfDrawer()"
          >
            <ng-icon *ngIf="item.icon" [name]="item.icon" class="w-5 h-5" />
            <span class="truncate">{{ item.label }}</span>
          </a>

          <!-- آیتم با زیرمنو -->
          <div *ngIf="item.children" class="flex flex-col gap-1">
            <button
              (click)="toggleSubmenu(item)"
              class="flex items-center justify-between gap-2 px-2 py-2 rounded hover:bg-gray-100 w-full"
              [class.bg-blue-50]="isActive(item)"
              [class.text-blue-600]="isActive(item)"
            >
              <div class="flex items-center gap-2">
                <ng-icon *ngIf="item.icon" [name]="item.icon" class="w-5 h-5" />
                <span class="truncate">{{ item.label }}</span>
              </div>
              <ng-icon
                name="matExpandMoreOutline"
                class="w-4 h-4 transition-transform"
                [class.rotate-180]="isSubmenuOpen(item)"
              />
            </button>

            <ul
              class="mr-6 mt-1 space-y-1 border-r border-gray-200 pr-2"
              [style.display]="isSubmenuOpen(item) ? 'block' : 'none'"
            >
              <li *ngFor="let child of item.children">
                <a
                  [routerLink]="child.routerLink"
                  class="flex items-center gap-2 px-2 py-1.5 rounded hover:bg-gray-100"
                  [class.bg-blue-50]="isActive(child)"
                  [class.text-blue-600]="isActive(child)"
                  (click)="onItemClickCloseIfDrawer()"
                >
                  <span class="truncate">{{ child.label }}</span>
                </a>
              </li>
            </ul>
          </div>
        </li>
      </ul>
    </nav>
  </div>
</div>
